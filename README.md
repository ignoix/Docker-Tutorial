# ğŸ³ Docker å­¦ä¹ æ¼”ç¤ºé¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Dockerå’ŒDocker Composeå­¦ä¹ æ¼”ç¤ºé¡¹ç›®ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Dockerå®¹å™¨åŒ–æŠ€æœ¯æ„å»ºä¸€ä¸ªå¾®æœåŠ¡æ¶æ„çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š
- **MySQLæ•°æ®åº“**ï¼šå­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œæ”¯æŒUTF-8å­—ç¬¦é›†
- **Node.js APIæœåŠ¡**ï¼šåŸºäºKoa2æ¡†æ¶çš„RESTful API
- **å‰ç«¯é¡µé¢**ï¼šå“åº”å¼Webç•Œé¢
- **Nginxåå‘ä»£ç†**ï¼šè´Ÿè½½å‡è¡¡å’Œé™æ€æ–‡ä»¶æœåŠ¡

## âœ¨ é¡¹ç›®ç‰¹è‰²

- **å®Œæ•´çš„å¾®æœåŠ¡æ¶æ„**ï¼šå±•ç¤ºDockerå®¹å™¨åŒ–æœ€ä½³å®è·µ
- **ä¸­æ–‡æ”¯æŒ**ï¼šMySQLé…ç½®UTF-8å­—ç¬¦é›†ï¼Œå®Œç¾æ”¯æŒä¸­æ–‡æ•°æ®
- **å¥åº·æ£€æŸ¥**ï¼šæ‰€æœ‰æœåŠ¡éƒ½é…ç½®äº†å¥åº·æ£€æŸ¥æœºåˆ¶
- **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨Dockeræ•°æ®å·ä¿å­˜MySQLæ•°æ®
- **ç°ä»£åŒ–UI**ï¼šå“åº”å¼å‰ç«¯ç•Œé¢ï¼Œæ”¯æŒå¢åˆ æ”¹æŸ¥æ“ä½œ

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx (80)    â”‚â”€â”€â”€â”€â”‚  Node.js (3000) â”‚â”€â”€â”€â”€â”‚   MySQL (3306)  â”‚
â”‚   åå‘ä»£ç†       â”‚    â”‚   APIæœåŠ¡        â”‚    â”‚   æ•°æ®åº“         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å‰ç«¯é¡µé¢ â”‚              â”‚ ç”¨æˆ·CRUD â”‚              â”‚ ç”¨æˆ·æ•°æ® â”‚
    â”‚ é™æ€æ–‡ä»¶ â”‚              â”‚ æ¥å£æœåŠ¡ â”‚              â”‚ æŒä¹…åŒ–   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
Docker-Tutorial/
â”œâ”€â”€ mysql/                    # MySQLæ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ Dockerfile           # MySQLé•œåƒæ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ my.cnf               # MySQLé…ç½®æ–‡ä»¶ï¼ˆå­—ç¬¦é›†è®¾ç½®ï¼‰
â”‚   â””â”€â”€ init/                # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚       â””â”€â”€ 01-create-user-table.sql
â”œâ”€â”€ nodejs/                   # Node.js APIæœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile           # Node.jsé•œåƒæ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ package.json         # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ app.js              # ä¸»åº”ç”¨æ–‡ä»¶
â”‚   â””â”€â”€ config.js           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ frontend/                # å‰ç«¯é¡µé¢
â”‚   â””â”€â”€ index.html          # ç”¨æˆ·ç®¡ç†ç•Œé¢
â”œâ”€â”€ nginx/                   # Nginxé…ç½®
â”‚   â”œâ”€â”€ Dockerfile          # Nginxé•œåƒæ„å»ºæ–‡ä»¶
â”‚   â””â”€â”€ nginx.conf          # Nginxé…ç½®æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml       # Docker Composeç¼–æ’æ–‡ä»¶
â”œâ”€â”€ .dockerignore           # Dockerå¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker Desktop (æ¨èç‰ˆæœ¬ 20.10+)
- Docker Compose (æ¨èç‰ˆæœ¬ 2.0+)

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd Docker-Tutorial
```

### 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up --build

# åå°è¿è¡Œ
docker-compose up -d --build
```

### 3. è®¿é—®åº”ç”¨

- **å‰ç«¯é¡µé¢**: http://localhost
- **APIæ¥å£**: http://localhost/api
- **å¥åº·æ£€æŸ¥**: http://localhost/health
- **MySQLæ•°æ®åº“**: localhost:3306

### 4. åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker-compose down -v
```

## ğŸ› ï¸ Docker å‘½ä»¤è¯¦è§£

### åŸºç¡€Dockerå‘½ä»¤

```bash
# æŸ¥çœ‹Dockerç‰ˆæœ¬
docker --version
docker-compose --version

# æŸ¥çœ‹Dockerä¿¡æ¯
docker info

# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰
docker ps -a

# æŸ¥çœ‹Dockeré•œåƒ
docker images

# æŸ¥çœ‹Dockerç½‘ç»œ
docker network ls

# æŸ¥çœ‹Dockeræ•°æ®å·
docker volume ls
```

### é•œåƒç®¡ç†

```bash
# æ„å»ºé•œåƒ
docker build -t <é•œåƒå> <æ„å»ºä¸Šä¸‹æ–‡è·¯å¾„>

# æ„å»ºæŒ‡å®šDockerfile
docker build -f <Dockerfileè·¯å¾„> -t <é•œåƒå> <æ„å»ºä¸Šä¸‹æ–‡è·¯å¾„>

# æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯
docker inspect <é•œåƒå>

# åˆ é™¤é•œåƒ
docker rmi <é•œåƒå>

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a
```

### å®¹å™¨ç®¡ç†

```bash
# è¿è¡Œå®¹å™¨
docker run -d -p <ä¸»æœºç«¯å£>:<å®¹å™¨ç«¯å£> <é•œåƒå>

# è¿è¡Œå®¹å™¨å¹¶æŒ‡å®šåç§°
docker run -d --name <å®¹å™¨å> -p <ä¸»æœºç«¯å£>:<å®¹å™¨ç«¯å£> <é•œåƒå>

# è¿è¡Œå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·
docker run -d -v <ä¸»æœºè·¯å¾„>:<å®¹å™¨è·¯å¾„> <é•œåƒå>

# è¿è¡Œå®¹å™¨å¹¶è®¾ç½®ç¯å¢ƒå˜é‡
docker run -d -e <ç¯å¢ƒå˜é‡å>=<å€¼> <é•œåƒå>

# è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨
docker exec -it <å®¹å™¨å> /bin/bash

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs <å®¹å™¨å>

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect <å®¹å™¨å>

# åœæ­¢å®¹å™¨
docker stop <å®¹å™¨å>

# å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨
docker start <å®¹å™¨å>

# é‡å¯å®¹å™¨
docker restart <å®¹å™¨å>

# åˆ é™¤å®¹å™¨
docker rm <å®¹å™¨å>

# åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨
docker container prune
```

### Docker Composeå‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up

# åå°å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up --build

# å¯åŠ¨æŒ‡å®šæœåŠ¡
docker-compose up <æœåŠ¡å>

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker-compose down -v

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹æŒ‡å®šæœåŠ¡æ—¥å¿—
docker-compose logs <æœåŠ¡å>

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# è¿›å…¥æœåŠ¡å®¹å™¨
docker-compose exec <æœåŠ¡å> /bin/bash

# é‡å¯æœåŠ¡
docker-compose restart <æœåŠ¡å>

# æ‰©å±•æœåŠ¡å®ä¾‹
docker-compose up --scale <æœåŠ¡å>=<æ•°é‡>

# æŸ¥çœ‹æœåŠ¡é…ç½®
docker-compose config

# éªŒè¯é…ç½®æ–‡ä»¶
docker-compose config --quiet
```

## ğŸ”§ æœåŠ¡é…ç½®è¯´æ˜

### MySQLæœåŠ¡

- **ç«¯å£**: 3306
- **æ•°æ®åº“**: docker_demo
- **ç”¨æˆ·å**: docker_user
- **å¯†ç **: docker_pass
- **Rootå¯†ç **: root123
- **å­—ç¬¦é›†**: utf8mb4
- **æ’åºè§„åˆ™**: utf8mb4_unicode_ci
- **å­—ç¬¦é›†é…ç½®**: é€šè¿‡my.cnfé…ç½®æ–‡ä»¶è®¾ç½®ï¼Œæ”¯æŒä¸­æ–‡å­˜å‚¨

### Node.js APIæœåŠ¡

- **ç«¯å£**: 3000
- **æ¡†æ¶**: Koa2
- **æ•°æ®åº“**: è¿æ¥MySQLæœåŠ¡
- **APIç«¯ç‚¹**:
  - `GET /api/users` - è·å–æ‰€æœ‰ç”¨æˆ·
  - `GET /api/users/:id` - è·å–æŒ‡å®šç”¨æˆ·
  - `POST /api/users` - åˆ›å»ºç”¨æˆ·
  - `PUT /api/users/:id` - æ›´æ–°ç”¨æˆ·
  - `DELETE /api/users/:id` - åˆ é™¤ç”¨æˆ·
  - `GET /health` - å¥åº·æ£€æŸ¥

### NginxæœåŠ¡

- **ç«¯å£**: 80
- **åŠŸèƒ½**: åå‘ä»£ç†ã€é™æ€æ–‡ä»¶æœåŠ¡
- **é…ç½®**: è‡ªåŠ¨ä»£ç†APIè¯·æ±‚åˆ°Node.jsæœåŠ¡

## ğŸ”¤ å­—ç¬¦é›†é…ç½®

æœ¬é¡¹ç›®å·²é…ç½®MySQLä½¿ç”¨UTF-8å­—ç¬¦é›†ï¼Œæ”¯æŒä¸­æ–‡æ•°æ®å­˜å‚¨ã€‚é…ç½®åŒ…æ‹¬ï¼š

- **my.cnf**: è®¾ç½®æœåŠ¡å™¨å­—ç¬¦é›†ä¸ºutf8mb4
- **Dockerfile**: è®¾ç½®ç¯å¢ƒå˜é‡MYSQL_CHARSET=utf8mb4
- **åˆå§‹åŒ–è„šæœ¬**: æ•°æ®åº“å’Œè¡¨éƒ½ä½¿ç”¨utf8mb4å­—ç¬¦é›†

å¦‚é‡ä¸­æ–‡ä¹±ç ï¼Œæ‰§è¡Œï¼š`docker-compose down -v && docker-compose up --build -d`

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :80
   lsof -i :3000
   lsof -i :3306
   
   # ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
   ```

2. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹å®¹å™¨æ—¥å¿—
   docker-compose logs <æœåŠ¡å>
   
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   docker-compose logs --tail=50 <æœåŠ¡å>
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
   docker-compose ps mysql
   
   # æ£€æŸ¥MySQLæ—¥å¿—
   docker-compose logs mysql
   
   # è¿›å…¥MySQLå®¹å™¨æ£€æŸ¥
   docker-compose exec mysql mysql -u root -p
   ```

4. **APIæœåŠ¡æ— æ³•è®¿é—®**
   ```bash
   # æ£€æŸ¥APIæœåŠ¡çŠ¶æ€
   docker-compose ps nodejs
   
   # æ£€æŸ¥APIæœåŠ¡æ—¥å¿—
   docker-compose logs nodejs
   
   # æµ‹è¯•APIè¿æ¥
   curl http://localhost:3000/health
   ```

5. **MySQLä¸­æ–‡ä¹±ç é—®é¢˜**
   ```bash
   # æ¸…ç†æ•°æ®å·é‡æ–°åˆå§‹åŒ–
   docker-compose down -v
   docker-compose up --build -d
   ```

### æ¸…ç†å‘½ä»¤

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œã€æ•°æ®å·
docker-compose down -v --remove-orphans

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -a

# åˆ é™¤æ‰€æœ‰æ•°æ®å·
docker volume prune

# åˆ é™¤æ‰€æœ‰ç½‘ç»œ
docker network prune
```

## ğŸ“š å­¦ä¹ è¦ç‚¹

### Dockeræ ¸å¿ƒæ¦‚å¿µ

1. **é•œåƒ(Image)**: åªè¯»çš„æ¨¡æ¿ï¼Œç”¨äºåˆ›å»ºå®¹å™¨
2. **å®¹å™¨(Container)**: é•œåƒçš„è¿è¡Œå®ä¾‹
3. **æ•°æ®å·(Volume)**: æŒä¹…åŒ–æ•°æ®å­˜å‚¨
4. **ç½‘ç»œ(Network)**: å®¹å™¨é—´é€šä¿¡
5. **Dockerfile**: æ„å»ºé•œåƒçš„æŒ‡ä»¤æ–‡ä»¶

### Docker Composeæ ¸å¿ƒæ¦‚å¿µ

1. **æœåŠ¡(Service)**: å®šä¹‰å®¹å™¨å¦‚ä½•è¿è¡Œ
2. **ç½‘ç»œ(Network)**: æœåŠ¡é—´é€šä¿¡
3. **æ•°æ®å·(Volume)**: æ•°æ®æŒä¹…åŒ–
4. **ä¾èµ–å…³ç³»**: æœåŠ¡å¯åŠ¨é¡ºåº
5. **å¥åº·æ£€æŸ¥**: æœåŠ¡çŠ¶æ€ç›‘æ§

### æœ€ä½³å®è·µ

1. **å¤šé˜¶æ®µæ„å»º**: å‡å°é•œåƒå¤§å°
2. **érootç”¨æˆ·**: æé«˜å®‰å…¨æ€§
3. **å¥åº·æ£€æŸ¥**: ç¡®ä¿æœåŠ¡å¯ç”¨æ€§
4. **æ•°æ®å·**: æŒä¹…åŒ–é‡è¦æ•°æ®
5. **ç¯å¢ƒå˜é‡**: é…ç½®å¤–éƒ¨åŒ–
6. **ç½‘ç»œéš”ç¦»**: æé«˜å®‰å…¨æ€§
7. **å­—ç¬¦é›†é…ç½®**: æ•°æ®åº“ä½¿ç”¨UTF-8å­—ç¬¦é›†ï¼Œæ”¯æŒå›½é™…åŒ–

## ğŸ”„ å¼€å‘æµç¨‹

### æœ¬åœ°å¼€å‘

1. ä¿®æ”¹ä»£ç 
2. é‡æ–°æ„å»ºé•œåƒ: `docker-compose build <æœåŠ¡å>`
3. é‡å¯æœåŠ¡: `docker-compose up -d <æœåŠ¡å>`

### ç”Ÿäº§éƒ¨ç½²

1. ä¿®æ”¹ç¯å¢ƒå˜é‡
2. æ„å»ºç”Ÿäº§é•œåƒ
3. ä½¿ç”¨ç”Ÿäº§çº§é…ç½®
4. è®¾ç½®ç›‘æ§å’Œæ—¥å¿—

## ğŸ“– æ‰©å±•å­¦ä¹ 

- [Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Composeæ–‡æ¡£](https://docs.docker.com/compose/)
- [Dockeræœ€ä½³å®è·µ](https://docs.docker.com/develop/dev-best-practices/)
- [Koa.jsæ–‡æ¡£](https://koajs.com/)
- [Nginxæ–‡æ¡£](https://nginx.org/en/docs/)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

MIT License

---

**Happy Docker Learning! ğŸ³**
